FROM ubuntu:20.04

ARG DEBIAN_FRONTEND=noninteractive

RUN apt update && apt install -y gcc python3

WORKDIR /home/ctfuser

COPY vuln.c .
COPY preload.c .
COPY index.html .

RUN gcc vuln.c -o vuln
RUN gcc -shared -fPIC preload.c -o evil.so -ldl

EXPOSE 9019
EXPOSE 9091

CMD bash -c "while true; do nc -lvp 8006 -e ./vuln; done & python3 -m http.server 9019"
